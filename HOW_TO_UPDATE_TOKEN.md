# 如何更新 Channel Access Token

## 📖 快速指南

### 第一步：進入帳號設定

1. 打開應用，選擇一個 LINE 官方帳號
2. 在專案選擇頁面，找到右上角的 **齒輪圖標** ⚙️
3. 點擊齒輪圖標

![齒輪圖標位置](docs/images/account-settings-button.png)

### 第二步：查看或編輯 Token

在彈出的「帳號設定」視窗中：

1. **帳號名稱**：顯示當前帳號（無法修改）
2. **Channel Access Token**：
   - 預設為隱藏狀態（顯示 `•••`）
   - 點擊眼睛圖標 👁️ 可顯示完整 Token
   - 再次點擊 🙈 可隱藏 Token

### 第三步：更新 Token

1. 到 [LINE Developers Console](https://developers.line.biz/console/) 取得新的 Token
2. 在「Channel Access Token」欄位中，清空並貼上新的 Token
3. 點擊 **「儲存變更」** 按鈕
4. 等待驗證（按鈕會顯示「驗證中...」）
5. 驗證成功後，會顯示 **「✓ Token 已成功更新」**
6. 視窗會在 2 秒後自動關閉

## 🔍 常見問題

### Q1: 為什麼需要更新 Token？

**答**：可能的原因：
- Token 即將到期或已過期
- Token 被不慎洩露，需要撤銷並更換
- 遷移到新的 LINE Channel
- 修改了 Channel 的權限設定

### Q2: 驗證失敗怎麼辦？

**答**：請檢查：
1. Token 是否完整複製（沒有多餘空格或換行）
2. Token 是否來自正確的 Channel
3. 該 Channel 是否啟用了 Messaging API
4. 網路連線是否正常

錯誤訊息範例：
- `Token 驗證失敗，請檢查是否正確` - Token 無效
- `驗證失敗: Connection timeout` - 網路問題

### Q3: 更新 Token 會影響現有資料嗎？

**答**：不會！
- 專案資料保留
- Rich Menu 設計保留
- 只有 Token 被更新

但是，如果是遷移到新 Channel，需要重新發布 Rich Menu。

### Q4: 可以取消更新嗎？

**答**：可以！
- 點擊「取消」按鈕
- 點擊右上角的 × 按鈕
- 點擊視窗外的背景

只要沒有點擊「儲存變更」並驗證成功，就不會更新 Token。

### Q5: Token 安全嗎？

**答**：是的！
- 顯示時預設為隱藏狀態（`password` 類型）
- 傳輸時使用 HTTPS
- 儲存在資料庫時使用 **Fernet 對稱加密**
- 只有本機應用可以存取

**安全建議**：
- 不要在公開場合顯示 Token
- 不要截圖並分享 Token
- 定期更換 Token

## 📋 詳細步驟（含截圖）

### 步驟 1：找到齒輪圖標

```
┌─────────────────────────────────────────────────┐
│  ← 返回   選擇專案   帳號：我的帳號   [⚙️]        │
│                                                 │
│  [專案卡片]  [專案卡片]  [+ 新增專案]            │
└─────────────────────────────────────────────────┘
                                        ↑
                                    點擊這裡
```

### 步驟 2：開啟帳號設定

```
┌─────────────────────────────────────┐
│  帳號設定                      [×]  │
├─────────────────────────────────────┤
│                                     │
│  帳號名稱                            │
│  ┌─────────────────────────────┐   │
│  │ 我的帳號                    │   │
│  └─────────────────────────────┘   │
│  帳號名稱無法修改                    │
│                                     │
│  Channel Access Token               │
│  ┌───────────────────────┬─────┐   │
│  │ •••••••••••••••••••• │ 👁️ │   │
│  └───────────────────────┴─────┘   │
│  您的 Token 將會安全地儲存           │
│                                     │
├─────────────────────────────────────┤
│              [取消]  [儲存變更]      │
└─────────────────────────────────────┘
```

### 步驟 3：顯示 Token（可選）

點擊眼睛圖標 👁️：

```
┌───────────────────────────────┬─────┐
│ Abc123...XyZ789               │ 🙈  │
└───────────────────────────────┴─────┘
```

### 步驟 4：更新並驗證

```
輸入新 Token → 點擊「儲存變更」
    ↓
┌─────────────────────────────────────┐
│  [驗證中...]  ← 按鈕禁用             │
└─────────────────────────────────────┘
    ↓
驗證成功
    ↓
┌─────────────────────────────────────┐
│  ✓ Token 已成功更新                 │
└─────────────────────────────────────┘
    ↓
2 秒後自動關閉
```

## 🛠️ 疑難排解

### 問題 1：找不到齒輪圖標

**可能原因**：
- 還在帳號選擇頁面（需要先選擇一個帳號）
- 瀏覽器快取問題

**解決方法**：
1. 確認已經進入「專案選擇」頁面
2. 強制刷新瀏覽器：
   - Windows: `Ctrl + Shift + R`
   - Mac: `Cmd + Shift + R`

### 問題 2：點擊齒輪沒有反應

**可能原因**：
- JavaScript 錯誤

**解決方法**：
1. 打開瀏覽器開發者工具（F12）
2. 查看 Console 是否有錯誤
3. 重新載入頁面

### 問題 3：Token 一直驗證失敗

**可能原因**：
- Token 無效或已過期
- Channel 設定問題
- 網路連線問題

**解決方法**：
1. 到 LINE Developers Console 檢查：
   - Channel 是否啟用
   - Token 是否有效
   - Issue new token（產生新的）
2. 檢查網路連線
3. 重試

### 問題 4：視窗打不開

**可能原因**：
- 模態框樣式問題

**解決方法**：
1. 檢查瀏覽器是否阻擋彈出視窗
2. 清除瀏覽器快取
3. 重新載入應用

## 📞 取得 LINE Channel Access Token

### 方法：LINE Developers Console

1. 前往 [LINE Developers Console](https://developers.line.biz/console/)
2. 登入您的 LINE 帳號
3. 選擇您的 Provider
4. 選擇您的 Channel（Messaging API）
5. 到「Messaging API」分頁
6. 找到「Channel access token」區段
7. 點擊「Issue」按鈕產生新 Token
8. 複製 Token（**注意：立即複製，之後無法再查看**）
9. 貼到應用的「帳號設定」中

### 注意事項

- 每個 Channel 可以有多個 Token
- Token 產生後無法再次查看，請立即複製並儲存
- 如果忘記 Token，只能產生新的
- 可以手動撤銷（Revoke）不再使用的 Token

## 🎯 最佳實踐

### 安全性

1. **定期更換 Token**：
   - 建議每 3-6 個月更換一次
   - 如有安全疑慮，立即更換

2. **妥善保管**：
   - 不要分享 Token
   - 不要提交到版本控制（Git）
   - 不要在公開場合顯示

3. **使用環境**：
   - 開發環境和正式環境使用不同的 Channel
   - 測試用 Token 和正式用 Token 分開

### 管理建議

1. **記錄更新時間**：
   - 在 LINE Developers Console 的備註中記錄
   - 或在專案文件中記錄

2. **備用 Channel**：
   - 準備一個備用 Channel
   - 緊急情況下快速切換

3. **監控使用狀況**：
   - 定期檢查 LINE Developers Console 的使用統計
   - 注意是否有異常活動

## 📚 相關文件

- [LINE Developers 官方文件](https://developers.line.biz/zh-hant/docs/messaging-api/channel-access-tokens/)
- [FEATURE_ACCOUNT_SETTINGS.md](FEATURE_ACCOUNT_SETTINGS.md) - 完整的技術文件
- [QUICK_FIX_SUMMARY.md](QUICK_FIX_SUMMARY.md) - 所有修復的摘要

---

**最後更新**：2024-10-21  
**版本**：1.0

